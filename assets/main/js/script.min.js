import { preloadImages } from "../../libs/utils.js";
let lenis = new Lenis();
function customDropdown() {
  let e = document.querySelectorAll(".dropdown-custom");
  function s(n) {
    e.forEach((e) => {
      var t = e.querySelector(".dropdown-custom-menu"),
        i = e.querySelector(".dropdown-custom-btn");
      (n && e === n) ||
        (t.classList.remove("dropdown--active"),
        i.classList.remove("--active"));
    });
  }
  e.forEach((t) => {
    let i = t.querySelector(".dropdown-custom-btn"),
      n = t.querySelector(".dropdown-custom-menu");
    var e = t.querySelectorAll(".dropdown-custom-item");
    let o = t.querySelector(".value-select");
    i.addEventListener("click", function (e) {
      e.stopPropagation(),
        s(t),
        n.classList.toggle("dropdown--active"),
        i.classList.toggle("--active");
    }),
      document.addEventListener("click", function () {
        s();
      }),
      e.forEach((n) => {
        n.addEventListener("click", function (e) {
          e.stopPropagation();
          var e = o.querySelector("img").src,
            t = o.querySelector("span").textContent,
            i = (o.innerHTML, n.innerHTML);
          (o.innerHTML = i),
            (n.innerHTML = `<img src="${e}" alt="" /><span>${t}</span>`),
            s();
        });
      }),
      window.addEventListener("scroll", function () {
        s();
      });
  });
}
function bookingForm() {
  var i;
  document.querySelector(".banner-booking") &&
    ((i = new Lightpick({
      field: document.getElementById("check-in"),
      secondField: document.getElementById("check-out"),
      singleDate: !1,
      minDate: moment().startOf("now"),
      numberOfMonths: 2,
      onOpen: function () {
        var e = i._opts.field.getBoundingClientRect(),
          t = i.el;
        e.top >= window.innerHeight / 2
          ? (t.style.top = e.top + window.scrollY - t.offsetHeight + "px")
          : (t.style.top = e.bottom + window.scrollY + "px"),
          (t.style.left = e.left + window.scrollX + "px");
      }
    })),
    document.querySelectorAll(".people, .child").forEach((e) => {
      let t = e.querySelector(".min");
      var i = e.querySelector(".plus");
      let n = e.querySelector(".val");
      (i.onclick = () => {
        var e = parseInt(n.textContent);
        (n.textContent = Math.min(e + 1, 10)),
          (t.style.opacity = 0 < n.textContent ? "1" : "0.5");
      }),
        (t.onclick = () => {
          var e = parseInt(n.textContent),
            e = Math.max(e - 1, 0);
          (n.textContent = e), (t.style.opacity = 0 < e ? "1" : "0.5");
        });
    }));
}
function sectionAccommodation() {
  $("section.accommodation").length < 1 ||
    $("section.accommodation").each(function () {
      var e = $(this),
        t = e.find(".accommodation-slider__main"),
        i = e.find(".swiper-pagination"),
        n = e.find(".swiper-button-prev"),
        e = e.find(".swiper-button-next"),
        o = t.hasClass("offer-slider");
      new Swiper(t[0], {
        spaceBetween: 24,
        slidesPerView: 1.2,
        speed: 1e3,
        slidesOffsetAfter: 24,
        pagination: { el: i[0], type: "progressbar" },
        breakpoints: {
          991: {
            spaceBetween: 40,
            slidesPerView: o ? 2.5 : 3.3,
            slidesOffsetAfter: 80
          }
        },
        navigation: { prevEl: n[0], nextEl: e[0] }
      });
    });
}
function swiperFacility() {
  new Swiper(".swiper-facility", {
    slidesPerView: 1,
    watchSlidesProgress: !0,
    speed: 1500,
    loop: !0,
    autoplay: { delay: 3e3 },
    pagination: { el: ".swiper-facility .swiper-pagination" },
    on: {
      progress(i) {
        i.slides.forEach((e) => {
          var t = (e.progress || 0) * (0.9 * i.width);
          isNaN(t) ||
            ((e = e.querySelector(".box-img")) &&
              (e.style.transform = `translate3d(${t}px, 0, 0)`));
        });
      },
      touchStart(e) {
        e.slides.forEach((e) => {
          e.style.transition = "";
        });
      },
      setTransition(e, t) {
        let i = "cubic-bezier(0.25, 0.1, 0.25, 1)";
        e.slides.forEach((e) => {
          e.style.transition = t + "ms " + i;
          e = e.querySelector(".box-img");
          e && (e.style.transition = t + "ms " + i);
        });
      }
    }
  });
}
function swiperAccommodation() {
  $(".swiper-accomodation").length < 1 ||
    $(".accommodation-detail").each(function () {
      var e = $(this).find(".swiper-accomodation"),
        t = e.closest(".detail-gallery").find(".swiper-pagination"),
        i = e.closest(".detail-gallery").find(".swiper-button-prev"),
        n = e.closest(".detail-gallery").find(".swiper-button-next");
      let r = new Swiper(e[0], {
        slidesPerView: 2.5,
        spaceBetween: 16,
        slidesOffsetAfter: 80,
        speed: 1e3,
        parallax: !0,
        pagination: { el: t[0], type: "progressbar" },
        navigation: { prevEl: i[0], nextEl: n[0] }
      });
      t = e.find(".swiper-slide").first().data("bs-target");
      let l = $(t);
      if (l.length) {
        let o = null,
          s = !1;
        e.find(".swiper-slide").on("click", function () {
          var e = $(this).index();
          l.modal("show"), r.slideTo(e, 0);
        }),
          l.on("shown.bs.modal", function () {
            let e = l.find(".swiper-accomodation-gallery"),
              t = l.find(".swiper-pagination"),
              i = l.find(".swiper-button-prev"),
              n = l.find(".swiper-button-next");
            e.addClass("swiper-hidden"),
              setTimeout(() => {
                o
                  ? (o.update(),
                    o.slideTo(r.activeIndex, 0),
                    e.removeClass("swiper-hidden").addClass("swiper-visible"))
                  : ((o = new Swiper(e[0], {
                      slidesPerView: "auto",
                      spaceBetween: 40,
                      speed: 1e3,
                      parallax: !0,
                      centeredSlides: !0,
                      pagination: { el: t[0], type: "progressbar" },
                      navigation: { prevEl: i[0], nextEl: n[0] },
                      on: {
                        slideChange: function () {
                          s ||
                            ((s = !0), r.slideTo(o.activeIndex, 0), (s = !1));
                        },
                        init: function () {
                          e.removeClass("swiper-hidden").addClass(
                            "swiper-visible"
                          );
                        }
                      }
                    })).update(),
                    o.slideTo(r.activeIndex, 0));
              }, 300);
          }),
          l.on("hidden.bs.modal", function () {
            o &&
              (l
                .find(".swiper-accomodation-gallery")
                .removeClass("swiper-visible")
                .addClass("swiper-hidden"),
              o.destroy(!0, !0),
              (o = null));
          });
      }
    });
}
function ctaMess() {
  ScrollTrigger.create({
    start: "top top",
    end: 99999,
    paused: !0,
    onUpdate: (e) => {
      1 === e.direction
        ? $("#cta-mess").addClass("hide")
        : $("#cta-mess").removeClass("hide");
    }
  });
}
function distortionImg() {
  document.querySelectorAll(".distortion-img").forEach((e) => {
    var t,
      i = e.querySelector("img");
    i &&
      ((t = i.src),
      (i.style.display = "none"),
      new hoverEffect({
        parent: e,
        intensity: 0.1,
        angle: 0,
        image1: t,
        image2: t,
        speedIn: 1.2,
        speedOut: 1.2,
        displacementImage: "./assets/images/distortion/7.jpg"
      }));
  });
}
function header() {
  var e = document.getElementById("hamburger");
  let t = document.getElementById("header-sub-menu");
  e.addEventListener("click", function () {
    this.classList.toggle("active"), t.classList.toggle("active");
  });
}
function filterGalleryMobile() {
  var e = document.querySelector(".filter-mobile");
  if (e) {
    let i = e.querySelector(".filter-value-select"),
      n = e.querySelector(".filter-head"),
      o = e.querySelector(".filter-body");
    e = o.querySelectorAll(".nav-link");
    i &&
      n &&
      o &&
      0 !== e.length &&
      (i.addEventListener("click", () => {
        n.classList.toggle("active"), o.classList.toggle("active");
      }),
      e.forEach((t) => {
        t.addEventListener("click", () => {
          var e = t.querySelector(".title-tab");
          console.log(e),
            e &&
              ((e = e.textContent.trim()),
              (i.textContent = e),
              n.classList.remove("active"),
              o.classList.remove("active"));
        });
      }));
  }
}
function animtionText() {
  gsap.registerPlugin(ScrollTrigger, SplitText),
    gsap.utils.toArray(".effect-line").forEach((e) => {
      var t = new SplitText(e, {
        type: "lines",
        linesClass: "line",
        mask: "lines"
      });
      gsap.fromTo(
        t.lines,
        { yPercent: 100, willChange: "transform" },
        {
          yPercent: 0,
          duration: 1,
          ease: "power3.out",
          stagger: 0.05,
          scrollTrigger: { trigger: e, start: "top 60%" }
        }
      );
    });
}
function modalBookingMobile() {
  let e = document.querySelector(".button-find-room "),
    t = document.querySelector(".banner-booking-mobile");
  document.querySelector(".btn-back").addEventListener("click", function () {
    e.classList.remove("hide"), t.classList.remove("active");
  }),
    e.addEventListener("click", function () {
      this.classList.add("hide"), t.classList.add("active");
    });
}
lenis.on("scroll", ScrollTrigger.update),
  gsap.ticker.add((e) => {
    lenis.raf(1e3 * e);
  }),
  gsap.ticker.lagSmoothing(0);
let init = () => {
  gsap.registerPlugin(ScrollTrigger),
    customDropdown(),
    bookingForm(),
    sectionAccommodation(),
    swiperFacility(),
    ctaMess(),
    distortionImg(),
    swiperAccommodation(),
    header(),
    filterGalleryMobile(),
    animtionText(),
    modalBookingMobile();
};
preloadImages("img").then(() => {
  init();
}),
  $(window).on("beforeunload", function () {
    $(window).scrollTop(0);
  });
