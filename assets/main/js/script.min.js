import{preloadImages}from"../../libs/utils.js";let lenis=new Lenis;function customDropdown(){let e=document.querySelectorAll(".dropdown-custom");function a(i){e.forEach(e=>{var t=e.querySelector(".dropdown-custom-menu"),o=e.querySelector(".dropdown-custom-btn");i&&e===i||(t.classList.remove("dropdown--active"),o.classList.remove("--active"))})}e.forEach(t=>{let o=t.querySelector(".dropdown-custom-btn"),i=t.querySelector(".dropdown-custom-menu");var e=t.querySelectorAll(".dropdown-custom-item");let r=t.querySelector(".value-select");o.addEventListener("click",function(e){e.stopPropagation(),a(t),i.classList.toggle("dropdown--active"),o.classList.toggle("--active")}),document.addEventListener("click",function(){a()}),e.forEach(n=>{n.addEventListener("click",function(e){e.stopPropagation();var e=r.querySelector("img").src,t=r.querySelector("span").textContent,o=n.querySelector("img").src,i=n.querySelector("span").textContent;r.querySelector("img").src=o,r.querySelector("span").textContent=i,n.querySelector("img").src=e,n.querySelector("span").textContent=t,a()})}),window.addEventListener("scroll",function(){a()})})}function bookingForm(){var o;document.querySelector(".banner-booking")&&(o=new Lightpick({field:document.getElementById("check-in"),secondField:document.getElementById("check-out"),singleDate:!1,minDate:moment().startOf("now"),numberOfMonths:2,onOpen:function(){var e=o._opts.field.getBoundingClientRect(),t=o.el;e.top>=window.innerHeight/2?t.style.top=e.top+window.scrollY-t.offsetHeight+"px":t.style.top=e.bottom+window.scrollY+"px",t.style.left=e.left+window.scrollX+"px"}}),document.querySelectorAll(".people, .child").forEach(e=>{let t=e.querySelector(".min");var o=e.querySelector(".plus");let i=e.querySelector(".val");o.onclick=()=>{var e=parseInt(i.textContent);i.textContent=Math.min(e+1,10),t.style.opacity=0<i.textContent?"1":"0.5"},t.onclick=()=>{var e=parseInt(i.textContent),e=Math.max(e-1,0);i.textContent=e,t.style.opacity=0<e?"1":"0.5"}}))}function bookingFormMobile(){var o;document.querySelector(".banner-booking-mobile")&&(o=new Lightpick({field:document.getElementById("check-in-mobile"),secondField:document.getElementById("check-out-mobile"),singleDate:!1,minDate:moment().startOf("now"),numberOfMonths:2,onOpen:function(){var e=o._opts.field.getBoundingClientRect(),t=o.el;e.top>=window.innerHeight/2?t.style.top=e.top+window.scrollY-t.offsetHeight+"px":t.style.top=e.bottom+window.scrollY+"px",t.style.left=e.left+window.scrollX+"px"}}),document.querySelectorAll(".people, .child").forEach(e=>{let t=e.querySelector(".min");var o=e.querySelector(".plus");let i=e.querySelector(".val");o.onclick=()=>{var e=parseInt(i.textContent);i.textContent=Math.min(e+1,10),t.style.opacity=0<i.textContent?"1":"0.5"},t.onclick=()=>{var e=parseInt(i.textContent),e=Math.max(e-1,0);i.textContent=e,t.style.opacity=0<e?"1":"0.5"}}))}function sectionAccommodation(){$("section.accommodation").length<1||$("section.accommodation").each(function(){var e=$(this),t=e.find(".accommodation-slider__main"),o=e.find(".swiper-pagination"),i=e.find(".swiper-button-prev"),e=e.find(".swiper-button-next"),n=t.hasClass("offer-slider");new Swiper(t[0],{spaceBetween:24,slidesPerView:1.2,speed:1e3,slidesOffsetAfter:24,pagination:{el:o[0],type:"progressbar"},breakpoints:{991:{spaceBetween:40,slidesPerView:n?2.5:3.3,slidesOffsetAfter:80}},navigation:{prevEl:i[0],nextEl:e[0]}})})}function swiperFacility(){document.querySelectorAll(".swiper-facility").forEach(e=>{let o;new Swiper(e,{slidesPerView:1,watchSlidesProgress:!0,speed:1500,loop:!0,autoplay:{delay:3e3},pagination:{el:e.querySelector(".swiper-pagination"),clickable:!0},on:{init(e){e.slides.forEach(e=>{e=e.querySelector(".caption");e&&(e.style.opacity="0",e.style.transition="opacity 0.6s ease")});let t=e.slides[e.activeIndex]?.querySelector(".caption");t&&(t.style.opacity="1",o=setTimeout(()=>{t.style.opacity="0"},2200))},slideChangeTransitionStart(e){e.slides.forEach(e=>{e=e.querySelector(".caption");e&&(e.style.opacity="0")}),clearTimeout(o)},slideChangeTransitionEnd(e){let t=e.slides[e.activeIndex]?.querySelector(".caption");t&&(t.style.opacity="1",o=setTimeout(()=>{t.style.opacity="0"},2200))},progress(o){o.slides.forEach(e=>{var t=(e.progress||0)*(.9*o.width),e=e.querySelector(".box-img");e&&!isNaN(t)&&(e.style.transform=`translate3d(${t}px, 0, 0)`)})},touchStart(e){e.slides.forEach(e=>{e.style.transition=""}),clearTimeout(o)},setTransition(e,t){let o="cubic-bezier(0.25, 0.1, 0.25, 1)";e.slides.forEach(e=>{e.style.transition=t+"ms "+o;e=e.querySelector(".box-img");e&&(e.style.transition=t+"ms "+o)})}}})})}function swiperAccommodation(){$(".swiper-accomodation").length<1||$(".accommodation-detail").each(function(){var e=$(this).find(".swiper-accomodation"),t=e.closest(".detail-gallery").find(".swiper-pagination"),o=e.closest(".detail-gallery").find(".swiper-button-prev"),i=e.closest(".detail-gallery").find(".swiper-button-next"),n=$(window).width()<992?1:2.5;let l=new Swiper(e[0],{slidesPerView:n,spaceBetween:24,slidesOffsetAfter:24,speed:1e3,parallax:!0,pagination:{el:t[0],type:"progressbar"},navigation:{prevEl:o[0],nextEl:i[0]}});n=e.find(".swiper-slide").first().data("bs-target");let s=$(n);if(s.length){let r=null,a=!1;e.find(".swiper-slide").on("click",function(){var e=$(this).index();s.modal("show"),l.slideTo(e,0)}),s.on("shown.bs.modal",function(){let t=s.find(".swiper-accomodation-gallery"),o=s.find(".swiper-pagination"),i=s.find(".swiper-button-prev"),n=s.find(".swiper-button-next");t.addClass("swiper-hidden"),setTimeout(()=>{var e;r?(r.update(),r.slideTo(l.activeIndex,0),t.removeClass("swiper-hidden").addClass("swiper-visible")):(e=$(window).width()<992?1:"auto",(r=new Swiper(t[0],{slidesPerView:e,spaceBetween:24,speed:1e3,parallax:!0,pagination:{el:o[0],type:"progressbar"},navigation:{prevEl:i[0],nextEl:n[0]},breakpoints:{991:{spaceBetween:40,slidesPerView:"auto"}},on:{slideChange:function(){a||(a=!0,l.slideTo(r.activeIndex,0),a=!1)},init:function(){t.removeClass("swiper-hidden").addClass("swiper-visible")}}})).update(),r.slideTo(l.activeIndex,0))},300)}),s.on("hidden.bs.modal",function(){r&&(s.find(".swiper-accomodation-gallery").removeClass("swiper-visible").addClass("swiper-hidden"),r.destroy(!0,!0),r=null)})}})}function ctaMess(){ScrollTrigger.create({start:"top top",end:99999,paused:!0,onUpdate:e=>{1===e.direction?$("#cta-mess").addClass("hide"):$("#cta-mess").removeClass("hide")}})}function distortionImg(){document.querySelectorAll(".distortion-img").forEach(e=>{var t,o=e.querySelector("img");o&&(t=o.src,o.style.display="none",new hoverEffect({parent:e,intensity:.1,angle:0,image1:t,image2:t,speedIn:1.2,speedOut:1.2,displacementImage:"./assets/images/distortion/7.jpg"}))})}function header(){var e=document.getElementById("hamburger");let t=document.getElementById("header-sub-menu");e.addEventListener("click",function(){this.classList.toggle("active"),t.classList.toggle("active")})}function filterGalleryMobile(){var e=document.querySelector(".filter-mobile");if(e){let o=e.querySelector(".filter-value-select"),i=e.querySelector(".filter-head"),n=e.querySelector(".filter-body");e=n.querySelectorAll(".nav-link");o&&i&&n&&0!==e.length&&(o.addEventListener("click",()=>{i.classList.toggle("active"),n.classList.toggle("active")}),e.forEach(t=>{t.addEventListener("click",()=>{var e=t.querySelector(".title-tab");console.log(e),e&&(e=e.textContent.trim(),o.textContent=e,i.classList.remove("active"),n.classList.remove("active"))})}))}}function animtionText(){gsap.registerPlugin(ScrollTrigger,SplitText),gsap.utils.toArray(".effect-line").forEach(e=>{var t=new SplitText(e,{type:"lines",linesClass:"line",mask:"lines"});gsap.fromTo(t.lines,{yPercent:100,willChange:"transform"},{yPercent:0,duration:1,ease:"power3.out",stagger:.05,scrollTrigger:{trigger:e,start:"top 60%"}})})}function modalBookingMobile(){let e=document.querySelector(".button-find-room "),t=document.querySelector(".banner-booking-mobile");var o=document.querySelector(".btn-back");e&&t&&o&&(o.addEventListener("click",function(){e.classList.remove("hide"),t.classList.remove("active")}),e.addEventListener("click",function(){this.classList.add("hide"),t.classList.add("active")}))}function itemParallax(){$(".js-parallax").length<1||$(".image-parallax").length<1||(gsap.utils.toArray(".js-parallax").forEach(e=>{var t=parseFloat(e.getAttribute("data-y"))||100,o=e.getAttribute("data-direction")||"up";gsap.fromTo(e,{y:"down"===o?-t:t},{y:0,scrollTrigger:{trigger:e,start:"top bottom",end:"bottom top",scrub:1,ease:"power4",delay:.2}})}),document.querySelectorAll(".image-parallax").forEach(e=>{var t=e.querySelector("img, video");t&&(gsap.set(t,{yPercent:10}),gsap.to(t,{yPercent:-10,ease:"none",scrollTrigger:{trigger:e,start:"top 80%",end:"bottom top",scrub:!0}}))}))}function bookingOffer(){let n=$("form.booking-offer");if(n.length){let o=n.find("input[name='startday']")[0],i=n.find("input[name='endday']")[0];o&&i&&new Lightpick({field:o,secondField:i,singleDate:!1,numberOfMonths:1,format:"DD/MM/YYYY",minDate:moment(),onSelect:function(e,t){try{e&&t&&(o.value=e.format("DD/MM/YYYY"),i.value=t.format("DD/MM/YYYY"),[o,i].forEach(e=>e.classList.remove("error")))}catch(e){console.error("Lỗi trong Lightpick onSelect:",e)}}}),n.on("submit",function(e){e.preventDefault();e={startday:n.find("input[name='startday']"),endday:n.find("input[name='endday']"),adult:n.find("input[name='adult']"),name:n.find("input[name='name']"),phone:n.find("input[name='phone']"),email:n.find("input[name='email']")};n.find(".error-message").remove(),n.find("input").removeClass("error");let o=!0;$.each(e,(e,t)=>{t.val().trim()||(t.addClass("error"),o=!1)}),o&&$.ajax({type:"POST",url:ajaxUrl,data:{action:"submit_contact_form",startday:e.startday.val().trim(),endday:e.endday.val().trim(),adult:e.adult.val().trim(),name:e.name.val().trim(),phone:e.phone.val().trim(),email:e.email.val().trim()},beforeSend:function(){$(".contact-message").remove(),console.log("Đang gửi dữ liệu...")},success:function(e){console.log("Phản hồi từ server:",e);let t="";!0===e.success?(t=`<span class="contact-message" style="color: green;">${e.data}</span>`,n.append(t),n[0].reset(),setTimeout(function(){$(".contact-message").fadeOut("slow",function(){$(this).remove()})},5e3)):(t=`<span class="contact-message" style="color: red;">${e.data||"Có lỗi xảy ra, vui lòng thử lại."}</span>`,n.append(t))},error:function(e,t,o){console.error("Lỗi khi gửi form:",o),$(".contact-message").remove(),n.append('<span class="contact-message" style="color: red;">Có lỗi xảy ra, vui lòng thử lại sau.</span>')}})})}}lenis.on("scroll",ScrollTrigger.update),gsap.ticker.add(e=>{lenis.raf(1e3*e)}),gsap.ticker.lagSmoothing(0);let init=()=>{gsap.registerPlugin(ScrollTrigger),customDropdown(),bookingForm(),sectionAccommodation(),swiperFacility(),ctaMess(),distortionImg(),swiperAccommodation(),header(),filterGalleryMobile(),animtionText(),modalBookingMobile(),itemParallax(),bookingOffer(),bookingFormMobile()},isLinkClicked=(preloadImages("img").then(()=>{init()}),!1);$("a").on("click",function(e){!this.href||this.href.match(/^#/)||this.href.match(/^javascript:/)||(isLinkClicked=!0)}),$(window).on("beforeunload",function(){isLinkClicked||$(window).scrollTop(0),isLinkClicked=!1});